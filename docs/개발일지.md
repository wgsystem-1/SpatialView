# SpatialView 개발일지

> 이 문서는 SpatialView 프로젝트의 개발 진행 상황을 **분류별 요약 + 일자별 상세**로 정리합니다.  
> **시간 기준: KST(UTC+9)**

## 📌 빌드 지침

> ⚠️ **항상 Release + win-x64**

```bash
# 빌드
dotnet build src/SpatialView/SpatialView.csproj -c Release -r win-x64

# 실행 파일
g:\Project\SpatialView\src\SpatialView\bin\Release\net10.0-windows\win-x64\SpatialView.exe
```

---

## ✅ 분류별 요약

### 1) 기능 구현

- **라벨링 기능**: 라벨 스타일/렌더러/설정 UI 구현
- **속성 테이블 저장/내보내기**: DBF 쓰기 + CSV/TSV 내보내기
- **좌표계 변환 기능 확장**: 레이어 변환 + 파일 저장
- **내보내기 UI/옵션 강화**: 미리보기/방위표/범례/제목 등 개선
- **측정 도구**: 거리/면적 측정 및 화면 경로 시각화
- **FileGDB 레이어 선택 정렬**: 컬럼 정렬 UI 제공

### 2) 기능 개선/버그 수정

- **피처 선택 안정화**: 좌표 변환 정밀도, 내부 클릭, 레이어 어댑터 보강
- **선택 하이라이트 표시 복구**: ID 매칭 실패와 지오메트리 재조회 문제 해결
- **필드 추가/삭제 저장 안정화**: 필드 구조 변경 시 DBF 재작성 및 레이어 복구
- **리소스 로딩 오류 해결**: `InitializeComponent()` 누락 복구
- **투명도/스타일 적용 문제 해결**: 엔진 스타일 동기화/투명도 계산 수정
- **프로젝트 로드 문제 해결**: FileGDB 디렉토리/다중 레이어 로드

### 3) 성능 개선

- 렌더링 배칭/캐싱/브러시-펜 캐싱
- 뷰포트 캐싱 및 불필요한 `ToList()` 제거
- `FastMapToScreen`/`Freeze()` 적용으로 렌더링 최적화

---

## 📅 일자별 상세

### 2026-01-16

#### 피처 선택/하이라이트/필드 저장 안정화

- App 리소스 로딩 오류 수정 (`InitializeComponent` 복구)
- 폴리곤 내부 클릭 선택 처리
- `Map.Layers` 어댑터 보강 및 선택 로직 재구현
- 하이라이트 ID 매칭/지오메트리 사용 개선
- 필드 삭제 후 저장 시 `SelectedLayer` 복구 로직 추가

#### 수정 파일 (2026-01-15)

- `src/SpatialView/App.xaml.cs`
- `src/SpatialView/ViewModels/MapViewModel.cs`
- `src/SpatialView.Infrastructure/GisEngine/SpatialViewMapEngine.cs`
- `src/SpatialView.Infrastructure/GisEngine/CustomMapCanvasAdapter.cs`
- `src/SpatialView/ViewModels/AttributePanelViewModel.cs`

#### 빌드

- Release/win-x64 (경고 0~6, 오류 0)

---

### 2026-01-15

#### 로깅 안정화

- `FileLogger.Initialize()` 실패 방지/폴백 경로 추가

#### 수정 파일

- `src/SpatialView.Engine/Diagnostics/FileLogger.cs`

---

### 2026-01-13

#### 피처 선택 정밀도 + 속성 저장 기능 강화

- Map.Size 동기화로 선택 정밀도 개선
- DBF 필드 구조 변경/재작성 지원
- 속성 테이블 저장/내보내기 UI 보강
- 편집 기능 렌더링 캐시 무효화 추가
- 스타일 변경 시 즉시 렌더 반영

#### 수정 파일(요약)

- `src/SpatialView/Views/Controls/MapControl.xaml.cs`
- `src/SpatialView/ViewModels/MapViewModel.cs`
- `src/SpatialView/ViewModels/AttributePanelViewModel.cs`
- `src/SpatialView.Engine/Data/Sources/ShapefileDataSource.cs`
- `src/SpatialView.Engine/Data/Layers/VectorLayer.cs`
- `src/SpatialView.Infrastructure/GisEngine/SpatialViewMapRenderer.cs`

---

### 2026-01-12

#### 성능/기능/UI 집중 개선

- 렌더링 최적화(배칭/캐시/Freeze/LOD 조정)
- 내보내기 미리보기/옵션 강화
- 측정 도구/좌표계 변환/편집 도구 개선
- 피처 선택 도구 버튼/스타일 적용 버그 수정
- 속성 테이블 DBNull 처리

#### 주요 수정 파일(요약, 2026-01-10)

- `src/SpatialView.Engine/Rendering/*`
- `src/SpatialView/Views/Dialogs/ExportDialog.*`
- `src/SpatialView/Views/Dialogs/CoordinateTransformDialog.*`
- `src/SpatialView/Views/Controls/MapControl.xaml.cs`
- `src/SpatialView/MainWindow.xaml(.cs)`
- `src/SpatialView/ViewModels/AttributePanelViewModel.cs`

---

### 2026-01-10

#### 라벨링/스타일/프로젝트 로드 기반 구축

- 라벨링 전반 구현(스타일/렌더링/UI)
- 투명도 동작 수정
- FileGDB 로드 이슈 해결(디렉토리/다중 레이어)
- 초기 문서/레포 구성

#### 주요 수정 파일(요약)

- `src/SpatialView.Engine/Rendering/*`
- `src/SpatialView.Engine/Styling/LabelStyle.cs`
- `src/SpatialView.Infrastructure/GisEngine/SpatialViewVectorLayerAdapter.cs`
- `src/SpatialView/ViewModels/LayerItemViewModel.cs`
- `src/SpatialView/Views/Dialogs/LabelSettingsDialog.*`
- `src/SpatialView/MainWindow.xaml(.cs)`
- `src/SpatialView/ViewModels/MainViewModel.cs`

---

## 📌 향후 계획

### 벤치마킹 기반 개선

- QGIS/ArcGIS Pro/Global Mapper 등과 비교하여 로딩/선택/하이라이트/속성 편집 체감 속도 개선
- 벤치마크 데이터셋(대용량 shp/gdb/gpkg/GeoTIFF 등) 표준화 및 반복 측정
- KPI: 로딩 시간, 선택 반응(ms), 메모리 피크, 렌더 FPS, 저장 성공률

### 사용성/UX

- 선택/하이라이트/속성 팝업 피드백 강화를 통한 즉시성 개선
- 오류 메시지/예외 흐름 정비(사용자 안내 중심)
- 단축키/컨텍스트 메뉴/작업 흐름 간소화

### 성능/안정성

- 대용량 데이터 로드 시 UI 프리징 개선(비동기 로딩/부분 로딩)
- 렌더링 최적화(타일 캐싱, LOD, 브러시/펜 캐싱 정교화)
- 메모리 사용량/GC 압력 감소

### 포맷/데이터 확장

- 벡터: GeoPackage, GeoJSON, KML, GML, TopoJSON, FlatGeobuf, GeoParquet
- 래스터: GeoTIFF/COG, MBTiles, ASC/DEM, JP2 등
- 서비스: WMS/WMTS/WFS/XYZ 타일
- DB: PostGIS, SpatiaLite

### 좌표계/변환

- 특정 좌표계 변환 오류 점검 및 자동 보정
- EPSG 코드 자동 탐지/설정 보강

### 품질/테스트

- 단위/통합/UI 테스트 도입 및 자동화
- 회귀 테스트 시나리오(선택/하이라이트/필드 저장)
